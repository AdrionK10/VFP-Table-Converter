local lcTextFile, lcExtension, lcFileType, lcHeading 
set safe on
set fullpath on
cd ?
=adir(aForms,"*.scx" )

If _tally = 0
	=MessageBox("No forms in this folder")
Else
   local lnLoopCounter
   FOR lnLoopCounter = 1 TO aLen("aForms",1)

      *lcSourceFile = getfile("" , "Open", "Open Source", 0)
	  lcSourceFile = aForms[lnLoopCounter,1]
      *lcTextFile = StrTran(lcSourceFile , "." ,"")+".txt"
      lcExtension = Upper(JustExt(lcSourceFile))

      lcTextFile = addbs(justpath(lcsourcefile))+juststem(lcsourcefile)+ lcExtension + ".txt"
      *lcTextFile = JustStem(lcSourceFile) + lcExtension + ".txt"

      lcFileType = "*"
      lcHeading = "* Generated by SourceToText "+chr(13)+chr(10)

      clear

      do case
      case lcExtension = "SCX"
         lcFileType = "K"
      case lcExtension = "LBX"
         lcFileType = "B"
      case lcExtension = "MNX"
         lcFileType = "M"
      case lcExtension = "FRX"
         lcFileType = "R"
      case lcExtension = "VCX"
         lcFileType = "V"
      case lcExtension = "DCX"
         lcFileType = "d"
      Otherwise 	
         lcFileType = "*"
      endcase

      * These are the project type identifiers for the files
      *#define PRJTYPE_FORM		"K"
      *#define PRJTYPE_LABEL		"B"
      *#define PRJTYPE_MENU		"M"
      *#define PRJTYPE_REPORT		"R"
      *#define PRJTYPE_VCX			"V"
      *#define PRJTYPE_DBC			"d"

      If lcFileType = "*"
         =messagebox("Wrong file selected")
      Else
         * ?strToFile(lcHeading  ,lcTextFile , .F.)
         do home()+"scctext" with lcSourceFile, lcFileType , lcTextFile , .T.
      Endif

      if file(lcTextFile)
         Wait  "Text file saved to "+lcTextFile window nowait 
      endif
   ENDFOR &&* lnLoopCounter = 1 TO aLen("aForms")
Endif && _tally > 0	

wait clear
